<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Timegodkjenning</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/latest/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="templates/footer.css" />
</head>

<body>
    <div class="container">
        {% include 'header.html' %}

        <span class="glyphicon glyphicon-arrow-left"></span><a href="index.php">Hovedside</a>
    <h1>Timegodkjenning</h1>
    <p>
        <form method="get">
            <input type="checkbox" name="visGodkjent" onClick="submit()" {% if visGodkjent %}checked{% endif %}/> Vis godkjente og avviste timer
        </form>
    </p>    
    {% if error == "ugyldigTimereg" %}
        <div class="alert alert-danger" role="alert">
            <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
            <span class="sr-only">Error:</span>
            Du har ikke tilgang til å godkjenne/avvise denne timeregistreringen
        </div>
    {% elseif error == "deaktivertTimereg" %}
        <div class="alert alert-danger" role="alert">
            <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
            <span class="sr-only">Error:</span>
            Du kan ikke godkjenne/avvise en deaktivert timeregistrering
        </div>
    {% endif %}

    <!--Teamleders team-->
    {% for team in teams %}
        <h2>{{ team.Navn }}</h2>

        <form action=timegodkjenning.php method=GET>
            <table class="table table-striped">
                <tr>
                    <th>Navn</th>
                    <th>Dato</th>
                    <th>Fra</th>
                    <th>Til</th>
                    <th>Pause</th>
                    <th>Oppgave</th>
                    <th>Status</th> 
                    <th>Endre status</th>
                </tr>
                    
                <!--Alle aktive (godkjent, venter godkjenning, avvist og gjenopprettede) timeoppføringer på teamet-->
                {% for timereg in timeregistreringer %}
                    {% if visGodkjent == "on" %}  <!-- Vis godkjente = vis de som er godkjent (0) og avvist (2) -->
                       {% if timereg.Tilstand == 0 or timereg.Tilstand == 2 %}
                            <tr>
                                <td>{{ brukerReg.hentBruker(timereg.BrukerId).Navn }}</td>
                                <td>{{ timereg.Dato }}</td>
                                <td>{{ timereg.Fra }}</td>
                                <td>{{ timereg.Til }}</td>
                                <td>{{ timereg.Pause }} min</td>
                                <td>{{ (oppgaveReg.hentOppgave(timereg.OppgaveId)).Navn }}</td>
                                <td>{{ timereg.TilstandTekst }}</td>
                                
                                {% if timereg.Tilstand == 0 %}
                                <td><a href="timegodkjenning.php?action=avvis&timeregId={{ timereg.Id }}&visGodkjent=on" class="btn btn-danger">
                                        Avvis
                                    </a></td>
                                {% elseif timereg.Tilstand == 2 %}
                                <td><a href="timegodkjenning.php?action=godkjenn&timeregId={{ timereg.Id }}&visGodkjent=on"  class="btn btn-success">
                                    Godkjenn
                                    </a></td>
                                {% endif %}
                            </tr>
                       {% endif %}
                    {% else %}  <!-- Viser de som kan godkjennes eller avvises, venter godkjenning (1) og gjenopprettet (4) --> 
                       {% if timereg.Tilstand == 1 or timereg.Tilstand == 4 %}
                            <tr>
                                <td>{{ brukerReg.hentBruker(timereg.BrukerId).Navn }}</td>
                                <td>{{ timereg.Dato }}</td>
                                <td>{{ timereg.Fra }}</td>
                                <td>{{ timereg.Til }}</td>
                                <td>{{ timereg.Pause }} min</td>
                                <td>{{ (oppgaveReg.hentOppgave(timereg.OppgaveId)).Navn }}</td>
                                <td>{{ timereg.TilstandTekst }}</td>
                                
                                
                                <td>
                                    <a href="timegodkjenning.php?action=godkjenn&timeregId={{ timereg.Id }}" class="btn btn-success">
                                        Godkjenn
                                    </a>
                                    <a href="timegodkjenning.php?action=avvis&timeregId={{ timereg.Id }}" class="btn btn-danger">
                                        Avvis
                                    </a></td>
                            </tr>
                       {% endif %}
                    
                    {% endif %}
                    
                {% endfor %}
            </table>
        </form>
    {% endfor %}
    </div>
    {% include 'footer.html' %}
</body>
</html>